# **DataWorks实操**

 一：开通服务，创建工作空间 

按照之前对DataWorks概念的了解，集成数据仓库需要开通DataWorks服务和MaxCompute引擎，只有绑定了引擎才能使用数据同步等服务。之前讲的数据分层就是基于MaxCompute的，我们新建的各个表都是建在MaxComputer上面的，建表语句、sql与mysql语句有差异。

我们可以在阿里云的dataworks中心绑定工作空间的引擎（需要单独购买MaxCompute）。这样就可以使用dataworks工作台和MaxCompute实现数据集成。

点击左上角的创建工作空间，

![image.png](文档图片/image-1677835198119.png)



![image.png](文档图片/image-1677835196425.png)



开通完成后在工作空间上会有已绑定MaxCompute引擎的标志，绑定了引擎才能正常使用DataWorks工作台。

![image.png](文档图片/image-1677835193582.png)



如果没绑定MaxCompute，后续的流程是没办法进行的，DataWorks工作面板会缺失一部分功能。

如果没有提前了解MaxCompute的概念，比较容易踩坑

![image.png](文档图片/image-1677835191419.png)



 二：数据采集 

![image.png](文档图片/image-1677835189404.png)





这些带有黄色、绿色、紫色等方框的选项都称作节点。其中DI离线同步和 ODPS SQl是做数据同步最常用的节点。节点，就是指一个流程当中流转至此，并且做出相应的数据处理。使用的时候我们需要长按左键把想要的节点拖拽到流程中。这种节点可以称之为功能节点，有自己的具体职责

![image.png](文档图片/image-1677835187014.png)



除此之外还有一个需要了解的节点，就是VI虚拟节点，在通用的目录下，这个节点可以理解为流程图里面的圆角矩形，里面写着开始和结束两个字。所以，，

![image.png](https://cdn.nlark.com/yuque/0/2023/png/29021020/1677479313538-a7714a5a-e796-42c4-9bb3-47078efa1c81.png)

是一切流程的开始。



![image.png](文档图片/image-1677835184242.png)

![image.png](文档图片/image-1677835181759.png)



了解了节点的概念之后我们就能得到这样一个流程图，不同节点之间可以用鼠标悬停变成手指之后进行画线链接，表示向下执行。

![image.png](文档图片/image-1677835178614.png)



这个流程图就很容易理解了，表示在这个流程中我需要把A表和B表两张表的数据同步到阿里云的MaxConputer数据库中去，形成最基本的ODS层。并且我将基于这两张表同步后的数据进行一定的数据开发，达到我想要的数据效果。



在操作这个流程图之前我们需要先建表，在MaxCompute数据库里面建立需要同步的表，ods开头的表结构应该和mysql的表结构保持一致

![image.png](文档图片/image-1677835176102.png)



例如以下取自阿里示例的DDL建表语句





建表之后，我们就可以把mysql库里的表同步到MaxCompute上。

那么如何进行同步配置呢？双击DI节点，可以在节点明细中配置我想要同步的数据。如下图：

![image.png](文档图片/image-1677835172951.png)



![image.png](文档图片/image-1677835170404.png)



点击执行之后可以关注下底下的日志，看看是否出错，可以关注一下这些日志关键字，看一看表里读取除了多少数据。

![image.png](文档图片/image-1677835168326.png)



除了这些配置以外，我们还需要虚拟节点VI帮助我们配置调度任务，

![image.png](文档图片/image-1677835164345.png)



![image.png](文档图片/image-1677835161656.png)



 以上节点配置完成之后，就可以提交任务了

![image.png](文档图片/image-1677835158697.png)

# DataWorks参考文档

 一：阿里云官方文档 

 1.1：操作流程说明 

https://help.aliyun.com/document_detail/122847.html

 1.2：操作流程视频 



 1.3：MaxCompute SQL语句快速入门 

https://help.aliyun.com/document_detail/27860.html

# Dataworks的那些坑



1：开了Dataworks服务是没有用的，每新建一个工作空间，都必须要绑定MaxCompute引擎，否则这个工作空间是没有意义的。在未开通MaxCompute的工作空间内将无法使用数据同步服务。

![image.png](文档图片/image-1677835788468.png)







2：我尝试在一个工作空间内创建多个数据源，比如我在生产环境的工作空间内创建开发库的数据源。我们需要建立两个数据源，一个就是我们自己服务器的开发库Mysql元数据，这个很简单，只需要连接上去就可以了，连通性也能测试成功，唯一要注意的是创建mysql数据库时必须要选择开发和生产隔离，因为不是开发和生产隔离的不能应用在dataWorks数据源里面。添加生产环境的时候可以添加，添加开发环境RAM账号需要开通权限才能添加。

![image.png](文档图片/image-1677835791058.png)







3：创建一个MaxCompute类型的数据库作为远程数据库，这一步需要提供AccessKeyId 和秘钥，同样需要权限

![image.png](文档图片/image-1677835793480.png)



在填写 ODPS项目名称的时候要注意，它这里只能填写一开始创建的工作空间的名称，如果像我这种把数据源挂在一个开通了MaxCompute下面，就只能填当前的工作空间名称。

但是这样就又出现了一个问题，就是在做数据同步的时候，选择目标MaxCompute数据源的时候扫表只会扫描绑定的工作空间下的表，没办法扫描到自己创建的表。想要扫描到自己创建的表，必须把自己建的表同时发布到开发环境和线上环境.

![image.png](文档图片/image-1677835795947.png)





4：执行了数据同步，日志也正确但是数据未同步

这个问题到现在都没有解决，找了阿里的dataworks客服，客服就说看日志查具体的失败原因，然后就没有答复了